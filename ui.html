<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marvi - Science-Based Matchmaking</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            font-family: 'Press Start 2P', cursive;
        }
        
        body {
            background: linear-gradient(45deg, #1a0033, #330066, #660099);
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .pixel-border {
            border: 4px solid #ff00ff;
            border-radius: 0;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }
        
        .pixel-button {
            background: linear-gradient(45deg, #ff0066, #cc0099);
            border: 3px solid #ffffff;
            color: white;
            padding: 15px 30px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(255, 0, 102, 0.4);
        }
        
        .pixel-button:hover {
            background: linear-gradient(45deg, #ff3399, #ff00cc);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 0, 102, 0.6);
        }
        
        .pixel-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .glitch {
            position: relative;
            animation: glitch 2s infinite;
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        
        .neon-text {
            text-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff, 0 0 30px #ff00ff;
            animation: neon-flicker 2s infinite alternate;
        }
        
        @keyframes neon-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .pixel-card {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #ff00ff;
            backdrop-filter: blur(10px);
            padding: 20px;
            margin: 20px 0;
        }
        
        .hidden {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pixel-character {
            width: 64px;
            height: 64px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border-radius: 50%;
            position: fixed;
            top: 50%;
            right: 50px;
            z-index: 1000;
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pixel-character:hover {
            transform: scale(1.2);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #333;
            border: 2px solid #ff00ff;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            transition: width 0.3s ease;
        }
        
        .loading-spinner {
            border: 4px solid #333;
            border-top: 4px solid #ff00ff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .match-card {
            background: linear-gradient(135deg, rgba(255, 0, 255, 0.1), rgba(0, 255, 255, 0.1));
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }
        
        .match-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 0, 255, 0.3);
        }
        
        .scale-option {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #666;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scale-option:hover {
            border-color: #ff00ff;
            background: rgba(255, 0, 255, 0.2);
            transform: translateX(10px);
        }
        
        .scale-option.selected {
            border-color: #ff00ff;
            background: rgba(255, 0, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }
        
        .personality-icon {
            font-size: 24px;
            margin-right: 15px;
            color: #ff00ff;
        }
        
        .section {
            min-height: 100vh;
            padding: 50px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-fixed {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 50;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .character-speech {
            position: fixed;
            top: 40%;
            right: 130px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ff00ff;
            padding: 15px;
            border-radius: 10px;
            max-width: 200px;
            z-index: 1001;
            font-size: 10px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .character-speech.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .question-counter {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border: 2px solid #ff00ff;
            border-radius: 5px;
            z-index: 1000;
        }

        input, select, textarea {
            background: rgba(0, 0, 0, 0.8) !important;
            border: 2px solid #ff00ff !important;
            color: white !important;
            padding: 10px !important;
            font-family: 'Press Start 2P', cursive !important;
            font-size: 10px !important;
        }

        input:focus, select:focus, textarea:focus {
            outline: none !important;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5) !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-fixed">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="text-2xl font-bold neon-text">MARVI</div>
                <div class="space-x-6">
                    <a href="#home" class="hover:text-pink-400 transition-colors">HOME</a>
                    <a href="#profile" class="hover:text-pink-400 transition-colors">PROFILE</a>
                    <a href="#matchmaking" class="hover:text-pink-400 transition-colors">MATCHING</a>
                    <a href="#start" class="hover:text-pink-400 transition-colors">START</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Animated Character -->
    <div class="pixel-character" id="character">
        <div class="w-full h-full flex items-center justify-center">
            <i class="fas fa-heart text-white text-2xl"></i>
        </div>
    </div>

    <!-- Character Speech Bubble -->
    <div class="character-speech" id="characterSpeech">
        Welcome to Marvi! Let's find your perfect match! ðŸ’•
    </div>

    <!-- Main Content -->
    <div id="landingPage">
        <!-- Home Section -->
        <section id="home" class="section">
            <div class="container mx-auto px-4 text-center">
                <div class="max-w-4xl mx-auto">
                    <h1 class="text-6xl font-bold mb-8 glitch neon-text">MARVI</h1>
                    <p class="text-2xl mb-8">PERSONALITY > APPEARANCE</p>
                    <div class="pixel-card">
                        <p class="text-lg mb-6">
                            Marvi revolutionizes how people connect by prioritizing personality compatibility 
                            over superficial traits. Built on the scientifically-validated Big Five personality 
                            model, it creates meaningful matches based on psychological alignment, emotional 
                            resonance, and shared values.
                        </p>
                        <p class="text-xl text-pink-300">
                            "Are we fundamentally compatible as people?"
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Get Started Section -->
        <section id="start" class="section">
            <div class="container mx-auto px-4">
                <div class="max-w-2xl mx-auto text-center">
                    <h2 class="text-4xl font-bold mb-8 neon-text">GET STARTED</h2>
                    <div class="pixel-card">
                        <p class="text-lg mb-8">Ready to find your perfect personality match?</p>
                        <button class="pixel-button" onclick="startAssessment()">
                            START ASSESSMENT
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Question Counter -->
    <div class="question-counter hidden" id="questionCounter">
        <span id="currentQuestion">1</span> / <span id="totalQuestions">20</span>
    </div>

    <!-- Personality Assessment -->
    <div id="personalityAssessment" class="hidden">
        <div class="min-h-screen flex items-center justify-center">
            <div class="max-w-2xl w-full mx-auto">
                <div class="pixel-card">
                    <div class="progress-bar mb-6">
                        <div class="progress-fill" id="progressFill" style="width: 5%"></div>
                    </div>
                    <h2 class="text-xl font-bold mb-6 text-center" id="questionText">Question will appear here</h2>
                    <div id="answerOptions" class="space-y-4">
                        <!-- Answer options will be populated here -->
                    </div>
                    <div class="mt-8 text-center">
                        <button id="nextButton" class="pixel-button" onclick="nextQuestion()" disabled>NEXT</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="hidden">
        <div class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="loading-spinner"></div>
                <h2 class="text-2xl font-bold mb-4 neon-text">ANALYZING YOUR PERSONALITY</h2>
                <p class="text-lg mb-4">Finding your perfect matches...</p>
                <div class="pixel-card">
                    <p class="text-sm" id="loadingText">Processing your responses...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Page -->
    <div id="resultsPage" class="hidden">
        <div class="min-h-screen py-20">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-4xl font-bold mb-8 text-center neon-text">YOUR PERSONALITY & MATCHES</h2>
                    <div class="pixel-card mb-8">
                        <h3 class="text-xl mb-4">YOUR PERSONALITY PROFILE</h3>
                        <div id="personalityResults" class="grid md:grid-cols-5 gap-4">
                            <!-- Personality scores will be shown here -->
                        </div>
                    </div>
                    <div id="matchResults">
                        <!-- Match results will be populated here -->
                    </div>
                    <div class="text-center mt-8">
                        <button class="pixel-button" onclick="resetAssessment()">START NEW ASSESSMENT</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Questions from the backend - these will be fetched dynamically
        let questions = [];
        let currentQuestionIndex = 0;
        let responses = {};

        // Scale options
        const scaleOptions = [
            {value: 1, label: 'Strongly Disagree'},
            {value: 2, label: 'Disagree'},
            {value: 3, label: 'Neutral'},
            {value: 4, label: 'Agree'},
            {value: 5, label: 'Strongly Agree'}
        ];

        // Character interactions
        const characterMessages = [
            "Let's get to know you better!",
            "Great choice! Keep going!",
            "You're doing amazing!",
            "Almost there!",
            "Perfect! Let's continue!",
            "Excellent progress!",
            "I'm learning so much about you!",
            "This is exciting!",
            "You're halfway there!",
            "Final stretch! You got this!"
        ];

        function showCharacterMessage(message) {
            const speech = document.getElementById('characterSpeech');
            speech.textContent = message;
            speech.classList.add('show');
            setTimeout(() => speech.classList.remove('show'), 3000);
        }

        async function startAssessment() {
            try {
                // Fetch questions from backend
                const response = await fetch('/api/questions');
                questions = await response.json();
                
                document.getElementById('landingPage').classList.add('hidden');
                document.getElementById('personalityAssessment').classList.remove('hidden');
                document.getElementById('personalityAssessment').classList.add('fade-in');
                document.getElementById('questionCounter').classList.remove('hidden');
                
                showQuestion();
                showCharacterMessage("Let's dive into your personality!");
            } catch (error) {
                console.error('Error loading questions:', error);
                // Fallback to hardcoded questions if backend fails
                questions = [
                    {id: 1, trait: 'openness', question: 'I enjoy trying new and unusual experiences', is_positive: true},
                    {id: 2, trait: 'openness', question: 'I prefer routine and familiar activities', is_positive: false},
                    {id: 3, trait: 'openness', question: 'I love exploring new ideas and concepts', is_positive: true},
                    {id: 4, trait: 'openness', question: 'I\'m curious about how things work', is_positive: true},
                    {id: 5, trait: 'conscientiousness', question: 'I always complete tasks on time', is_positive: true},
                    {id: 6, trait: 'conscientiousness', question: 'I keep my workspace organized', is_positive: true},
                    {id: 7, trait: 'conscientiousness', question: 'I often procrastinate on important tasks', is_positive: false},
                    {id: 8, trait: 'conscientiousness', question: 'I pay attention to details', is_positive: true},
                    {id: 9, trait: 'extraversion', question: 'I enjoy being the center of attention', is_positive: true},
                    {id: 10, trait: 'extraversion', question: 'I feel energized after social gatherings', is_positive: true},
                    {id: 11, trait: 'extraversion', question: 'I prefer quiet, solitary activities', is_positive: false},
                    {id: 12, trait: 'extraversion', question: 'I find it easy to start conversations', is_positive: true},
                    {id: 13, trait: 'agreeableness', question: 'I try to help others when I can', is_positive: true},
                    {id: 14, trait: 'agreeableness', question: 'I trust people easily', is_positive: true},
                    {id: 15, trait: 'agreeableness', question: 'I often get into arguments with others', is_positive: false},
                    {id: 16, trait: 'agreeableness', question: 'I\'m sympathetic to others\' problems', is_positive: true},
                    {id: 17, trait: 'neuroticism', question: 'I often worry about things', is_positive: true},
                    {id: 18, trait: 'neuroticism', question: 'I get stressed easily', is_positive: true},
                    {id: 19, trait: 'neuroticism', question: 'I remain calm under pressure', is_positive: false},
                    {id: 20, trait: 'neuroticism', question: 'I rarely feel anxious or nervous', is_positive: false}
                ];
                
                document.getElementById('landingPage').classList.add('hidden');
                document.getElementById('personalityAssessment').classList.remove('hidden');
                document.getElementById('personalityAssessment').classList.add('fade-in');
                document.getElementById('questionCounter').classList.remove('hidden');
                
                showQuestion();
                showCharacterMessage("Let's dive into your personality!");
            }
        }

        function showQuestion() {
            const question = questions[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = questions.length;
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Create answer options
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            scaleOptions.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'scale-option';
                optionDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <span>${option.label}</span>
                        <span class="text-pink-400">${option.value}</span>
                    </div>
                `;
                optionDiv.addEventListener('click', () => selectAnswer(option.value, optionDiv));
                optionsContainer.appendChild(optionDiv);
            });
            
            document.getElementById('nextButton').disabled = true;
        }

        function selectAnswer(value, element) {
            // Remove previous selections
            document.querySelectorAll('.scale-option').forEach(el => el.classList.remove('selected'));
            
            // Select current option
            element.classList.add('selected');
            
            // Store response
            responses[questions[currentQuestionIndex].id] = value;
            
            // Enable next button
            document.getElementById('nextButton').disabled = false;
            
            // Show character reaction
            const messageIndex = Math.floor(Math.random() * characterMessages.length);
            showCharacterMessage(characterMessages[messageIndex]);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                showQuestion();
            } else {
                finishAssessment();
            }
        }

        async function finishAssessment() {
            document.getElementById('personalityAssessment').classList.add('hidden');
            document.getElementById('questionCounter').classList.add('hidden');
            document.getElementById('loadingScreen').classList.remove('hidden');
            document.getElementById('loadingScreen').classList.add('fade-in');
            
            const loadingMessages = [
                "Processing your responses...",
                "Analyzing personality traits...",
                "Calculating compatibility scores...",
                "Finding your perfect matches...",
                "Almost ready!"
            ];
            
            let messageIndex = 0;
            const loadingInterval = setInterval(() => {
                document.getElementById('loadingText').textContent = loadingMessages[messageIndex];
                messageIndex++;
                if (messageIndex >= loadingMessages.length) {
                    clearInterval(loadingInterval);
                    submitToBackend();
                }
            }, 1500);
        }

        async function submitToBackend() {
            try {
                const response = await fetch('/submit-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(responses)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResults(result.scores);
                } else {
                    console.error('Backend error:', result.error);
                    // Fallback to frontend calculation
                    const scores = calculatePersonalityScores();
                    showResults(scores);
                }
            } catch (error) {
                console.error('Network error:', error);
                // Fallback to frontend calculation
                const scores = calculatePersonalityScores();
                showResults(scores);
            }
        }

        function calculatePersonalityScores() {
            const traitScores = {
                openness: 0,
                conscientiousness: 0,
                extraversion: 0,
                agreeableness: 0,
                neuroticism: 0
            };
            
            questions.forEach(question => {
                const response = responses[question.id];
                let score = response;
                
                // For negative questions, reverse the score
                if (!question.is_positive) {
                    score = 6 - response;
                }
                
                traitScores[question.trait] += score;
            });
            
            return traitScores;
        }

        function categorizeScore(score) {
            if (score <= 7) return 'very_low';
            if (score <= 11) return 'low';
            if (score <= 15) return 'moderate';
            if (score <= 18) return 'high';
            return 'very_high';
        }

        function showResults(scores) {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('resultsPage').classList.remove('hidden');
            document.getElementById('resultsPage').classList.add('fade-in');
            
            // Show personality results
            const resultsContainer = document.getElementById('personalityResults');
            resultsContainer.innerHTML = '';
            
            const traitIcons = {
                openness: 'fas fa-eye',
                conscientiousness: 'fas fa-tasks',
                extraversion: 'fas fa-users',
                agreeableness: 'fas fa-heart',
                neuroticism: 'fas fa-exclamation-triangle'
            };
            
            Object.entries(scores).forEach(([trait, score]) => {
                const category = categorizeScore(score);
                const percentage = (score / 20) * 100;
                
                const traitDiv = document.createElement('div');
                traitDiv.className = 'text-center';
                traitDiv.innerHTML = `
                    <i class="${traitIcons[trait]} text-2xl text-pink-400 mb-2"></i>
                    <h4 class="text-sm font-bold">${trait.toUpperCase()}</h4>
                    <div class="text-lg font-bold">${score}/20</div>
                    <div class="text-xs text-pink-300">${Math.round(percentage)}%</div>
                `;
                resultsContainer.appendChild(traitDiv);
            });
            
            // Load matches from backend
            loadMatches();
            showCharacterMessage("Here are your perfect matches! ðŸ’•");
        }

        async function loadMatches() {
            try {
                const response = await fetch('/matches');
                if (response.ok) {
                    const html = await response.text();
                    // This would be better handled with proper API endpoints
                    showMockMatches();
                } else {
                    showMockMatches();
                }
            } catch (error) {
                console.error('Error loading matches:', error);
                showMockMatches();
            }
        }

        function showMockMatches() {
            const mockProfiles = [
                {name: 'Alex Johnson', age: 28, location: 'San Francisco', compatibility: 92},
                {name: 'Jordan Smith', age: 25, location: 'New York', compatibility: 88},
                {name: 'Casey Davis', age: 30, location: 'Los Angeles', compatibility: 85},
                {name: 'Riley Chen', age: 27, location: 'Chicago', compatibility: 82},
                {name: 'Morgan Taylor', age: 29, location: 'Seattle', compatibility: 78}
            ];
            
            const matchContainer = document.getElementById('matchResults');
            matchContainer.innerHTML = '<h3 class="text-2xl font-bold mb-6">TOP MATCHES</h3>';
            
            mockProfiles.forEach((profile, index) => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'match-card';
                matchDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-600 rounded-full flex items-center justify-center mr-4">
                                <i class="fas fa-user text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="text-xl font-bold">${profile.name}</h4>
                                <p class="text-sm text-gray-300">${profile.age} years old â€¢ ${profile.location}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-bold text-green-400">${profile.compatibility}%</div>
                            <div class="text-sm text-gray-300">Match</div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${profile.compatibility}%"></div>
                        </div>
                    </div>
                `;
                matchContainer.appendChild(matchDiv);
            });
        }

        function resetAssessment() {
            currentQuestionIndex = 0;
            responses = {};
            
            document.getElementById('resultsPage').classList.add('hidden');
            document.getElementById('landingPage').classList.remove('hidden');
            document.getElementById('landingPage').classList.add('fade-in');
            
            showCharacterMessage("Ready for another assessment?");
        }

        // Character interactions
        document.getElementById('character').addEventListener('click', function() {
            const randomMessage = characterMessages[Math.floor(Math.random() * characterMessages.length)];
            showCharacterMessage(randomMessage);
        });

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Initialize character message
        setTimeout(() => {
            showCharacterMessage("Welcome to Marvi! Let's find your perfect match! ðŸ’•");
        }, 2000);
    </script>
</body>
</html>
